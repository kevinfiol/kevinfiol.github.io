<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content="ie=edge" http-equiv=X-UA-Compatible><meta content="kevin f.'s personal site" name=description><link rel="shortcut icon" href=https://kevinfiol.com/img/favicon.png type=image/x-icon><link href=https://kevinfiol.com/css/main.css rel=stylesheet><link href=https://kevinfiol.com/atom.xml rel=alternate title=feed type=application/atom+xml><title>
            
                Mithril.js + esbuild + JSX
            
        </title><body><div class=dark-mode-container><input id=darkSwitch type=checkbox><label class=dark-mode-btn for=darkSwitch>ðŸŒ’</label></div><main class="main-content max-width-3 mx-auto"><div><div class="controls p1"><a href=https://github.com/kevinfiol/kevinfiol.com/edit/master/content/blog/2021-03-18-mithriljs-esbuild-jsx.md>edit</a></div><header><nav><p class=h3><a href=/>kevin f.</a></nav></header><small class="h5 p0 m0 light-subdue"> March 18, 2021 </small><aside></aside><article class=page-content><h1 id=mithril-js-esbuild-jsx><a aria-label="Anchor link for: mithril-js-esbuild-jsx" class=zola-anchor href=#mithril-js-esbuild-jsx>#</a>Mithril.js + esbuild + JSX</h1><p><strong>EDIT 7/18/2022:</strong> esbuild has since added support for <a href=https://github.com/evanw/esbuild/issues/1217>string literals as JSX fragments</a>, meaning much of what I wrote below is now unnecessary. To use JSX with Mithril and esbuild, all you need to do is set <code>jsxFragment: '"["'</code> in your esbuild config. See <a href=https://github.com/kevinfiol/newt/blob/master/scripts/bundle.js>here</a> for an example.<p>I recently bootstrapped a <a href=https://mithril.js.org>Mithril.js</a> project using <a href=https://esbuild.github.io/>esbuild</a> for my bundling purposes. If you don't already know, esbuild is a next-gen bundler written in Go by <a href=https://github.com/evanw>Evan Wallace</a> that is magnitudes faster than rollup, webpack, or parcel (all of which are written in JS/TS).<p>esbuild comes with JSX support out of the box. While I don't normally use JSX, I decided to create a demo for <a href=https://mithril.netlify.app>mithril.netlify.app</a> showing off that JSX works just fine in a Mithril application. However, I ran into one major issue -- esbuild wasn't compiling JSX fragments correctly when providing <code>m.fragment</code> as the JSX fragment pragma.<p>After some digging around, I found <a href="https://gitter.im/mithriljs/mithril.js?at=5b98ce1c51a02e2a261ac656">this comment</a> by <a href=https://github.com/isiahmeadows>Claudia Meadows</a>.<p>In short, there's no support for Mithril fragments as Components currently. esbuild (as well as transpilers like Sucrase) compiles JSX using the provided jsx pragma + jsx fragment method in the form of:<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span style=color:#bf616a>React</span><span>.</span><span style=color:#96b5b4>createElement</span><span>(</span><span style=color:#bf616a>React</span><span>.</span><span style=color:#bf616a>Fragment</span><span>, </span><span style=color:#d08770>null</span><span>, "</span><span style=color:#a3be8c>Stuff</span><span>");
</span></code></pre><p>See <a href=https://esbuild.github.io/api/#jsx-fragment>here</a> for more details.<p>Which in Mithril's case, can't work with <code>m.fragment</code>. Following Claudia's advice, defining a simple Fragment component as so worked for me. I just put this in my <code>index.js</code> file near the top:<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span style=color:#bf616a>m</span><span>.</span><span style=color:#bf616a>Fragment </span><span>= { </span><span style=color:#8fa1b3>view</span><span>: </span><span style=color:#bf616a>vnode </span><span style=color:#b48ead>=> </span><span style=color:#bf616a>vnode</span><span>.</span><span style=color:#bf616a>children </span><span>};
</span></code></pre><p>Then I just set <code>jsxFragment</code> to <code>m.Fragment</code> instead of <code>m.fragment</code> in my esbuild config and voilÃ ! Fragments work as you'd expect.<pre class=language-js data-lang=js style=color:#c0c5ce;background-color:#2b303b><code class=language-js data-lang=js><span style=color:#b48ead>var </span><span style=color:#bf616a>JSX </span><span>= {
</span><span>  </span><span style=color:#8fa1b3>view</span><span>: </span><span style=color:#b48ead>function</span><span>() {
</span><span>    </span><span style=color:#b48ead>return </span><span>(
</span><span>      <>
</span><span>        &LTh2></span><span style=color:#bf616a>JSX</span><span>&LT/</span><span style=color:#bf616a>h2</span><span>>
</span><span>        &LTp></span><span style=color:#bf616a>You could use JSX with Mithril</span><span>.</span><span style=color:#bf616a>js </span><span style=color:#b48ead>as </span><span>well.&LT/p>
</span><span>        &LTp></span><span style=color:#bf616a>Be aware that this requires a build</span><span>-</span><span style=color:#bf616a>step</span><span>.&LT/</span><span style=color:#bf616a>p</span><span>>
</span><span>        <</span><span style=color:#bf616a>p style</span><span>={{ color: '</span><span style=color:#a3be8c>red</span><span>' }}>
</span><span>            </span><span style=color:#bf616a>Attributes work </span><span style=color:#b48ead>as </span><span>expected.
</span><span>        &LT/</span><span style=color:#bf616a>p</span><span>>
</span><span>        &LTp></span><span style=color:#bf616a>This application uses </span><span><</span><span style=color:#bf616a>a href</span><span>="</span><span style=color:#a3be8c>https://esbuild.github.io/</span><span>"></span><span style=color:#bf616a>esbuild</span><span>&LT/</span><span style=color:#bf616a>a</span><span>> </span><span style=color:#bf616a>to convert JSX</span><span>.&LT/</span><span style=color:#bf616a>p</span><span>>
</span><span>      &LT/>
</span><span>    );
</span><span>  }
</span><span>};
</span></code></pre><p>For reference, you can see my full esbuild config and my bundle scripts <a href=https://github.com/kevinfiol/mithril-pres/tree/master/scripts>here</a>. Direct any questions to <a href=mailto:me@kevinfiol.com>me@kevinfiol.com</a> and I'd be happy to answer them.</article><footer class=mt2><small> <a href=#>return to top</a> </small></footer></div></main><script src=https://kevinfiol.com/js/dark-mode-switch.min.js></script>